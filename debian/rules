#!/usr/bin/make -f

# GCL comes in two flavours. We need the ANSI one.
export GCL_ANSI=t

# On xenial/64 bit GCL did run into a testbench error. The following
# line is supposed to fix it:
export GCL_MEM_MULTIPLE=0.1

# The standard rule.
%:
	dh $@

# Tell configure to produce a build for three lisps.
# ecl would be a fourth potential lisp. But (at least in Oct 2017)
# https://bugs.launchpad.net/ubuntu/+source/ecl/+bug/317827
# prevents creating ubuntu packages using ecl.
override_dh_auto_configure:
	./bootstrap
	dh_auto_configure -- --enable-sbcl --enable-clisp --enable-gcl

# This rule isn't necessary in order to build any package. But it is
# helpful when a build server is used as it causes the test suite
# to output the full test log in case of a build server.
override_dh_auto_test:
	if make check; then true; else cat tests/test-suite.log;false;fi

get-orig-source:
	uscan --force-download --repack --rename --destdir .

# This one is really important: The maxima source contains a folder named
# "binary" whose existance without declaring "binary" as a phony make target
# will signal make that it doesn't need to build the binary.
.PHONY: get-orig-source binary

binary:
	dh $@
